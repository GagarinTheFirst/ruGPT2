# RuGPT2
Russian GPT-2 model

This repository is based on Nvidia GPT-2 realisation from [Megatron-LM](https://github.com/NVIDIA/Megatron-LM). And uses [YouTokenToMe](https://github.com/VKCOM/YouTokenToMe) toketizer.

## Pretrain GPT-2 model

1. Cleanup data and preprocess json:
```
python3 scripts/cleanup_dataset.py <input_file.txt> <output_file.json>
```
2. Preprocess data for training:
```
python3 scripts/split_gpt2_json.py \
    --input_files <input_file.json> \
    --output_dir <output_dir> \
    --test_percent 0.001 \
```
3. Run training:
```
./scripts/pretrain_gpt2_yttm.sh
```

## Generate text samples

### GPT-2 medium
```
./scripts/generate_text_yttm_file.sh
```

Generated samples:
```
Context:Не выходи из комнаты,


Megatron-LM:откуда ты пришел. Вадим, я к тебе не приеду. - Не беспокойся, - сказал он, стоя у входа в спальню. - Это я в последнюю секунду включил свет. - За всеми этими разговорами я и не заметил, как ты в... спальню зашел. - Ладно, иди. Я спать лягу. - Я сейчас умыться приду, - сказала Ольга и скрылась в спальне. - Вот так само собой получилось, - подсказал Виктор. - Я подумал, что ты придешь не один, а с другом, которого ты никогда не видела. Ну как в кино смотришь. - Спасибо! - сказала Ольга. Вадим вышел из комнаты, оставив Олега наедине с душевными противоречиями. Приведя себя в порядок, он покинул квартиру Олега. Предстояло провести расследование в таком ракурсе, чтобы оно полностью совпадало с выводами, сделанными Ольгой. Натравить на него самого Вадима. А вот это вряд ли даст положительный результат. Он должен быть, а не казаться странным. Вадим невольно позавидовал Олегу, который и на свободе обставил свое пребывание в Малоярославе - 2 нес какую - то чушь, пока находился у Олега. Разница в его поведении с Вадимом была незначительной. Досуг в Малоярославе продолжался до раннего утра. Утром Вадим вышел на улицу без куртки. Но зато в его руках было то, о чем он так долго мечтал. Разочарование от встречи с Олегом было настолько сильным и сильным, что у Вадима перехватило дыхание, а сердце стало стучать неровно, как после длительной пробежки. Наступает конец немного ранее намеченного срока, когда он уже готов свернуть с намеченного пути, но вместо этого ждет автомобиль Олега, чтобы уехать домой и обдумать все по дороге. - Поступай, как знаешь, - сказал он себе и зашагал к проезжей части дороги, чтобы проехаться на автобусе до Малоярославля и вернуться назад. Он любил город Малоярослав - 1. В нем он чувствовал себя своим человеком и драгоценным гостем. Доехав до остановки, он вышел из автобуса и, не глядя по сторонам, двинулся по улице в сторону Малоярославского кладбища. Это был небольшой старый двухэтажный дом с обшарпанными окнами и покосившимся забором. На нем четверо мужчин в черных одеждах торопились занять свое место на кладбище. При виде Вадима они встрепенулись и повернулись в его сторону. - Не бойся, - сказал один из них, стоящий чуть в стороне. - Тебе нельзя на кладбище. Там тебя настигнет та, которую ты ищешь. Я тебе

Context:Какой русский не любит


Megatron-LM:быстрой езды - При чём тут скорость! - Эх, дурак ты, мужику пятнадцать лет! Раньше здесь была большая деревня. Но когда этот обормот извозом стал... А всё из - за меня! - пропыхтел ещё один из собеседников, человек с двумя чёрными волосами и козлиной бородкой. - Из - за тебя - переспросил третий и, хлопнув себя по колену, мечтательно произнёс : - В моей жизни было много всякого. Часто проезжал границу, через многие страны. Чаще всего из России в Турцию и Турцию. И везде встречался с разными людьми. - Да уж, - поддержал разговор третий, когда разговор перерос в спор относительно темы Запада и Востока. - Но я вырос в СССР, - внёс свою лепту третий. - И с детства помню, как страны были против нашей. Нам всё было не так, и поэтому мы были великими. А нынче всё наоборот : всё наоборот, всё наоборот. Везде достаток, а нас обокрали или просрали. Как это отразится на всём мире - то Люди будут возмущаться и возмущаться. Начнут власть ругать. А мы будем делать всё, чтобы оградить нашу землю, нашу Родину. Но есть одно, что я не могу сделать своими руками... - Но вы знаете, что такое власть - перебил его четвёртый. - Мы уже были у власти. Был такой Брежнев. Он был самым главным во всём мире. - Какой у него номер - спросил его четвёртый человек, лысый мужчина лет сорока и с небольшой бородой.
```

### GPT-2 small
```
./scripts/generate_text_yttm_file_small.sh
```

Generated samples:
```
Context:Что день грядущий нам готовит? Его


Megatron-LM:нет тут. Он не может нас убить. Может, я был слеп? В этом он обижен. Ему нравится быть таким сильным. Я знаю, что у нас постоянный план и ни у кого не может быть сомнений, что он прав, но я хочу, чтобы он нас поддержал. Сегодня я утверждаю, что моя битва на Кубке чемпионов пройдет в Москве. Она состоится завтра. - Можете полечить? - Ехидная тетка не любит бегать, если у вас больше не будет соревнований. Я опять запретила носить спортивный костюм. Как только вы его разрешили использовать, я попросила вас надеть сшитые больше чем на все лето. - Мой ответ все еще не реализован, но я бы хотела, чтобы он добился успеха. Если он адмирал, то он может принести пользу. Полет здания его не впечатляет. Посмотрите, что творится сейчас. - Я не могу это контролировать. - Вы в Америке? - С биомолекулами. Там, в Америке. Боже, как же мне не хочется раскошелиться на своих солдатиков и выставить на всеобщее обозрение мою кандидатуру. Натурально. Что - то у них там происходит с человеком. - Шутите, вы правы. Что я могу сделать? - Ко всему этому вы должны уделить значительное внимание. - Может быть, стоит пойти туда? - Эти немногие, а может быть, и то и другое, чтобы сделать единоборства, способные стать в этом году полезным периодом. Маска для походов. Я хочу, чтобы они появились. Потребуется много времени и сил. Но это не значит, что они ввести меня в заблуждение. Они все равно не смогут там появиться. - Вам не приходило в голову, что мне угрожает опасность, если я … - Я не знаю, как это, и не собираюсь сейчас этого делать. Ни в коем случае. Это очень опасная ситуация, но я не могу допустить, чтобы министры в один голос заговорили о всеобщих вопросах. - С вами не так, и тогда вы тоже не сможете здесь появляться. Мы не защищены. Мы не можем быть частью единого целого. - Вы так думаете? - Я думаю. Они даже не слишком злятся, если я поеду на Кубок … - Я очень сильно сожалею. Я хочу думать о том, чтобы убедить их. - Но мне кажется, все согласятся. - Да? - Я в безопасности. Безоговорочно я застряну на этом корабле. Каждое выступление с Нейтральной Территорией меня успокаивает, однако если я буду предпринимать какие - то действия, я стану более осторо

Context:Однажды, в студеную зимнюю пору, я


Megatron-LM:решил пройтись по повседневному городскому парку. В глубине парка я нашел несколько симпатичных постоялых дворов, в которых он, правда, был помещен. Вот и я остановился. Меня невольно охватил восторг перед какой - то особой какой - то таинственной женщиной и сразу же обратил внимание на ее лицо. На этот раз я был в русском наряде, и на нем было чисто выбритое смоляное платье. Я вернулся в парк и позвонил вам. Прошу вас извинить меня, я не так давно приехал и из Москвы позвонил, но, боюсь, не узнал что - то важное. Слушая и слушая радио, я думал, что съемки картины будут еще интереснее. Видимо, я все же узнаю, о чем говорил этот молодой человек. Вдруг с каким - то мрачным удивлением, с глубоким разочарованием, я повернулся к нему и спросил, нет ли в парке людей, которые занимались этим в прошлом! Я узнал об этом только потому, что он был на работе, и мне стало неудобно от него. Кроме того, в доме было еще много людей, и мне хотелось, чтобы он забежал за мной, чтобы я встретил его по телефону, с другой стороны, поскольку жена моя, судя по всей видимости, в нашем обществе была малознакома с людьми, подлежащими тому или иному делу, который теперь есть в нашей семье. Кроме меня, здесь было еще много, и летом люди часто заходили на прогулки, и я только тут спросил, не было ли у него телефонного провода. Гость, как только он вошел, спросил, что мне еще делать, и я ответил, что все в порядке, но, разумеется, приехать трудно. Я вышел и в темноте огляделся. Я постучал в дверь и увидел, как посетитель вошел, и вошел. Они были довольно угрюмы, и многие не могли разговаривать друг с другом. Кто - то, по обыкновению, не замедлил войти, но потом подошел к нам и протянул руку. Я сел в кресло и, поджав под себя ноги, погрузился в работу. Не могу себе позволить подходить ко входу, тем более, что дверь в кабинет была не заперта. Но, как всегда, меня охватила тревога : я почувствовал, что эта женщина совсем одна, и, если бы я так и делал, мне бы непременно пришлось подниматься наверх. По - моему, она действительно себя не видела, и я взял ее за руку, и она стала спускаться. Я снял пальто и предложил ему присесть. Он постарался с непривычки. Кабинет был заставлен всякой мелочью, и я сел напротив.
```